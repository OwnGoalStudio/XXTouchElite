"use strict";(self.webpackChunkxxtouch_lite=self.webpackChunkxxtouch_lite||[]).push([[9635],{1680:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>n,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"appendix/paths-and-permissions","title":"Paths and Permissions","description":"The runtime root directory of XXTouch\xa0Elite is /usr/local/xxtouch, which contains all configuration files, daemon logs, built-in and third-party Lua extensions, etc.","source":"@site/docs/appendix/paths-and-permissions.md","sourceDirName":"appendix","slug":"/appendix/paths-and-permissions","permalink":"/docs/appendix/paths-and-permissions","draft":false,"unlisted":false,"editUrl":"https://github.com/OwnGoalStudio/XXTouchElite/tree/main/docs/appendix/paths-and-permissions.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"appendixSidebar","previous":{"title":"Scripts and Modules","permalink":"/docs/appendix/scripts-and-modules"},"next":{"title":"Logging Facilities","permalink":"/docs/appendix/logging-facilities"}}');var t=o(4848),s=o(8453);const n={sidebar_position:2},l="Paths and Permissions",a={},c=[{value:"Permissions and Ownership",id:"permissions-and-ownership",level:2},{value:"RootHide Instructions",id:"roothide-instructions",level:2},{value:"System Root (rootfs)",id:"system-root-rootfs",level:3},{value:"Jailbreak Root (jbroot)",id:"jailbreak-root-jbroot",level:3},{value:"Shell Environment",id:"shell-environment",level:3}];function d(e){const r={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"paths-and-permissions",children:"Paths and Permissions"})}),"\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.strong,{children:"runtime root directory"})," of XXTouch\xa0Elite is ",(0,t.jsx)(r.code,{children:"/usr/local/xxtouch"}),", which contains all configuration files, daemon logs, built-in and third-party Lua extensions, etc."]}),"\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.strong,{children:"user root directory"})," of XXTouch\xa0Elite is ",(0,t.jsx)(r.code,{children:"/var/mobile/Media/1ferver"}),". The scripts you develop, the logs and data you output, the resources and configuration files you depend on should all be placed in this directory. You can retrieve these paths in the ",(0,t.jsx)(r.code,{children:"utils.paths"})," table:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-lua",metastring:'title="utils.paths"',children:'{\n  MEDIA_UID = 501,\n  MEDIA_GID = 501,\n  MEDIA_ROOT = "/var/mobile/Media/1ferver",                         -- User root directory\n  MEDIA_LUA_DIR = "/var/mobile/Media/1ferver/lua",                  -- User script root directory\n  MEDIA_LUA_SCRIPTS_DIR = "/var/mobile/Media/1ferver/lua/scripts",  -- User script directory\n  MEDIA_BIN_DIR = "/var/mobile/Media/1ferver/bin",                  -- *Executable file directory\n  MEDIA_LIB_DIR = "/var/mobile/Media/1ferver/lib",                  -- *Dynamic library directory\n  MEDIA_LOG_DIR = "/var/mobile/Media/1ferver/log",                  -- Log directory\n  MEDIA_CONF_DIR = "/var/mobile/Media/1ferver/conf",                -- *Configuration file directory\n  MEDIA_WEB_DIR = "/var/mobile/Media/1ferver/web",                  -- Web static resource directory\n  MEDIA_IMG_DIR = "/var/mobile/Media/1ferver/img",                  -- Image directory\n  MEDIA_RES_DIR = "/var/mobile/Media/1ferver/res",                  -- Resource directory\n  MEDIA_CACHES_DIR = "/var/mobile/Media/1ferver/caches",            -- Cache directory\n  MEDIA_SNIPPETS_DIR = "/var/mobile/Media/1ferver/snippets",        -- Code snippet directory\n  MEDIA_UICFG_DIR = "/var/mobile/Media/1ferver/uicfg",              -- UI configuration directory\n  MEDIA_TESSDATA_DIR = "/var/mobile/Media/1ferver/tessdata",        -- Tesseract data directory\n  LOG_SYS = "/var/mobile/Media/1ferver/log/sys.log",                             -- System log\n  LOG_LAUNCHER_OUTPUT = "/var/mobile/Media/1ferver/log/script_output.log",       -- Script output log\n  LOG_LAUNCHER_ERROR = "/var/mobile/Media/1ferver/log/script_error.log",         -- Script error log\n}\n'})}),"\n",(0,t.jsx)(r.admonition,{type:"danger",children:(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["You should not tamper with or delete any content under the ",(0,t.jsx)(r.strong,{children:"runtime root directory"}),"."]}),"\n",(0,t.jsxs)(r.li,{children:["You should not tamper with or delete subdirectories marked with ",(0,t.jsx)(r.code,{children:"*"})," under the ",(0,t.jsx)(r.strong,{children:"user root directory"})," (executable file directory, dynamic library directory, and configuration file directory)."]}),"\n"]})}),"\n",(0,t.jsx)(r.h2,{id:"permissions-and-ownership",children:"Permissions and Ownership"}),"\n",(0,t.jsxs)(r.p,{children:["The XXTouch\xa0Elite script process is started by the ",(0,t.jsx)(r.code,{children:"root"})," user. Therefore, files created in your script will have ",(0,t.jsx)(r.code,{children:"root"})," as the default owner."]}),"\n",(0,t.jsxs)(r.p,{children:["All files written to the application container or the ",(0,t.jsx)(r.strong,{children:"user root directory"})," should be set to ",(0,t.jsx)(r.code,{children:"rw-r--r--"})," permissions, i.e., ",(0,t.jsx)(r.code,{children:"0644"}),". All subdirectories created in the application container or the ",(0,t.jsx)(r.strong,{children:"user root directory"})," should be set to ",(0,t.jsx)(r.code,{children:"rwxr-xr-x"}),", i.e., ",(0,t.jsx)(r.code,{children:"0755"}),". They should also be set to ",(0,t.jsx)(r.code,{children:"mobile"})," as the owner and ",(0,t.jsx)(r.code,{children:"mobile"})," as the group, i.e., ",(0,t.jsx)(r.code,{children:"501"}),". For efficiency, XXTouch\xa0Elite will not handle this for you. You should use the ",(0,t.jsx)(r.code,{children:"luaposix"})," library to set file permissions and ownership:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-lua",children:'local posix = require("posix")\nlocal unistd = require("posix.unistd")\nlocal my_path = utils.paths.MEDIA_LUA_DIR .. "/cloud_cc.lua"\nnLog(posix.chmod(my_path, "rw-r--r--"))\nnLog(unistd.chown(my_path, utils.paths.MEDIA_UID, utils.paths.MEDIA_GID))\n'})}),"\n",(0,t.jsx)(r.admonition,{type:"caution",children:(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Incorrect file system permissions or ownership may cause your script to fail, the application to crash, the operating system to behave abnormally, and other issues."}),"\n"]})}),"\n",(0,t.jsx)(r.h2,{id:"roothide-instructions",children:"RootHide Instructions"}),"\n",(0,t.jsx)(r.h3,{id:"system-root-rootfs",children:"System Root (rootfs)"}),"\n",(0,t.jsxs)(r.p,{children:["In the RootHide environment, the ",(0,t.jsx)(r.strong,{children:"system root"})," refers to the root directory of the iOS system, which is unmodified and contains no additional paths."]}),"\n",(0,t.jsx)(r.h3,{id:"jailbreak-root-jbroot",children:"Jailbreak Root (jbroot)"}),"\n",(0,t.jsxs)(r.p,{children:["In the RootHide environment, the ",(0,t.jsx)(r.strong,{children:"jailbreak root"})," is a randomly mounted path under the system root. It is usually located at ",(0,t.jsx)(r.code,{children:"/var/containers/Bundle/Application/.jbroot-XXXXXXXXXXXXXXXX/"})," (where the long string of Xs is a random value)."]}),"\n",(0,t.jsxs)(r.p,{children:["Using the ",(0,t.jsx)(r.code,{children:"jbroot"})," function, you can convert a normal path into a path within the jailbreak root. For example, if you want to access ",(0,t.jsx)(r.code,{children:"/var/mobile/Library/Preferences/1.txt"})," in the jailbreak root, you should use ",(0,t.jsx)(r.code,{children:'jbroot("/var/mobile/Library/Preferences/1.txt")'})," to access it. In a script, using ",(0,t.jsx)(r.code,{children:'f = io.open(jbroot("/var/mobile/Library/Preferences/1.txt"), "r")'})," will actually open the file located at ",(0,t.jsx)(r.code,{children:"/var/containers/Bundle/Application/.jbroot-XXXXXXXXXXXXXXXX/var/mobile/Library/Preferences/1.txt"}),"."]}),"\n",(0,t.jsx)(r.h3,{id:"shell-environment",children:"Shell Environment"}),"\n",(0,t.jsxs)(r.p,{children:["As described in the previous sections, the jailbreak root is mounted at a random path under the system root. However, in the Shell environment (e.g., ",(0,t.jsx)(r.code,{children:".deb"})," installation scripts), it is impossible to determine where the jailbreak root is located under the system root. Therefore, RootHide sets the runtime of Shell scripts to the jailbreak root. This means that ",(0,t.jsx)(r.code,{children:"/Applications/XXTExplorer.app"})," in a ",(0,t.jsx)(r.code,{children:".deb"})," package will be installed to ",(0,t.jsx)(r.code,{children:"/var/containers/Bundle/Application/.jbroot-XXXXXXXXXXXXXXXX/Applications/XXTExplorer.app"}),". This ensures that the installed jailbreak plugins do not pollute the system root."]}),"\n",(0,t.jsxs)(r.p,{children:["However, this approach introduces a problem: when using functions like ",(0,t.jsx)(r.code,{children:"os.execute"})," or ",(0,t.jsx)(r.code,{children:"io.popen"})," in XXTouch\xa0Elite, since ",(0,t.jsx)(r.code,{children:"os.execute"})," indirectly uses bash or zsh to execute Shell commands, their runtime will also be in the jailbreak root. As a result, all Shell commands cannot access files in the system root. For example, if you originally wanted to execute ",(0,t.jsx)(r.code,{children:"ls /var/mobile/Library/Preferences"})," in the Shell to list a large number of user preference ",(0,t.jsx)(r.code,{children:".plist"})," files in the system root, the Shell runtime in the jailbreak root will instead execute ",(0,t.jsx)(r.code,{children:"ls /var/containers/Bundle/Application/.jbroot-XXXXXXXXXXXXXXXX/var/mobile/Library/Preferences"}),", where there may be no files at all."]}),"\n",(0,t.jsxs)(r.p,{children:["To address this, RootHide mounts the system root back into the jailbreak root at ",(0,t.jsx)(r.code,{children:"/rootfs/"}),". This allows you to use ",(0,t.jsx)(r.code,{children:'os.execute("ls /rootfs/var/mobile/Library/Preferences")'})," in scripts to list the user preference ",(0,t.jsx)(r.code,{children:".plist"})," files in the system root."]}),"\n",(0,t.jsx)(r.admonition,{type:"tip",children:(0,t.jsxs)(r.p,{children:["You can use the ",(0,t.jsx)(r.code,{children:"rootfs"})," function to convert a normal path into a path within the system root ",(0,t.jsx)(r.strong,{children:"for use in the Shell environment"})," \u2014 essentially, it just adds the ",(0,t.jsx)(r.code,{children:"/rootfs/"})," prefix. The above example can also be written as ",(0,t.jsx)(r.code,{children:'os.execute("ls " .. rootfs("/var/mobile/Library/Preferences"))'}),"."]})})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,r,o)=>{o.d(r,{R:()=>n,x:()=>l});var i=o(6540);const t={},s=i.createContext(t);function n(e){const r=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:n(e.components),i.createElement(s.Provider,{value:r},e.children)}}}]);