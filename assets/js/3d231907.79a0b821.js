"use strict";(self.webpackChunkxxtouch_lite=self.webpackChunkxxtouch_lite||[]).push([[5854],{5808:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>c});const l=JSON.parse('{"id":"appendix/command-line-tools","title":"Command Line Tools","description":"In addition to script processes governed by global process scheduling, you can also use the Lua command-line interpreter to execute other scripts.","source":"@site/docs/appendix/command-line-tools.md","sourceDirName":"appendix","slug":"/appendix/command-line-tools","permalink":"/docs/appendix/command-line-tools","draft":false,"unlisted":false,"editUrl":"https://github.com/OwnGoalStudio/XXTouchElite/tree/main/docs/appendix/command-line-tools.md","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"appendixSidebar","previous":{"title":"Startup Script","permalink":"/docs/appendix/startup-script"},"next":{"title":"Prebuilt Libraries","permalink":"/docs/appendix/prebuilt-libraries"}}');var t=a(4848),i=a(8453);const s={sidebar_position:8},r="Command Line Tools",o={},c=[{value:"Activate the Environment",id:"activate-the-environment",level:2},{value:"Modes of Operation",id:"modes-of-operation",level:2},{value:"Interactive Mode",id:"interactive-mode",level:3},{value:"Enhanced Interactive Mode",id:"enhanced-interactive-mode",level:3},{value:"Interpreter Mode",id:"interpreter-mode",level:3},{value:"Daemon Mode <code>daemon.lua</code>",id:"daemon-mode-daemonlua",level:3},{value:"Instructions",id:"instructions",level:4},{value:"Example",id:"example",level:4},{value:"Built-in Command Line Tools",id:"built-in-command-line-tools",level:2},{value:"Record HID Events (<strong>hidrecorder</strong>)",id:"record-hid-events-hidrecorder",level:3},{value:"Instructions",id:"instructions-1",level:4},{value:"Example",id:"example-1",level:4},{value:"Install and Uninstall Apps (<strong>installer.lua</strong>)",id:"install-and-uninstall-apps-installerlua",level:3},{value:"Declaration",id:"declaration",level:4},{value:"Parameters and Return Values",id:"parameters-and-return-values",level:4},{value:"Example",id:"example-2",level:4},{value:"Start and Stop Remote Access (<strong>remote-access.lua</strong>)",id:"start-and-stop-remote-access-remote-accesslua",level:3},{value:"Declaration",id:"declaration-1",level:4},{value:"Instructions",id:"instructions-2",level:4},{value:"Example",id:"example-3",level:4},{value:"Remote Lock and Unlock (<strong>remote-lock.lua</strong>)",id:"remote-lock-and-unlock-remote-locklua",level:3},{value:"Declaration",id:"declaration-2",level:4},{value:"Parameters and Return Values",id:"parameters-and-return-values-1",level:4},{value:"Example",id:"example-4",level:4},{value:"Uninstall XXTouch\xa0Elite (<strong>uninstall-xxtouch.sh</strong>)",id:"uninstall-xxtouchelite-uninstall-xxtouchsh",level:3},{value:"Example",id:"example-5",level:4}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"command-line-tools",children:"Command Line Tools"})}),"\n",(0,t.jsxs)(n.p,{children:["In addition to script processes governed by global ",(0,t.jsx)(n.a,{href:"/docs/appendix/process-scheduling",children:"process scheduling"}),", you can also use the Lua command-line interpreter to execute other scripts."]}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsx)(n.p,{children:"The command-line tools introduced in this chapter require root privileges to execute."})}),"\n",(0,t.jsx)(n.h2,{id:"activate-the-environment",children:"Activate the Environment"}),"\n",(0,t.jsx)(n.p,{children:"After logging into the device via OpenSSH, you need to execute the following command to activate the XXTouch\xa0Elite command-line environment. Otherwise, the commands in subsequent sections will not work."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:". xxtouch\n"})}),"\n",(0,t.jsx)(n.h2,{id:"modes-of-operation",children:"Modes of Operation"}),"\n",(0,t.jsx)(n.h3,{id:"interactive-mode",children:"Interactive Mode"}),"\n",(0,t.jsx)(n.p,{children:"The Lua command-line interpreter can run in interactive mode (REPL mode), which means you can input Lua code in the command line and execute it immediately. After activating the environment, interactive mode can be started with the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"lua\n"})}),"\n",(0,t.jsx)(n.p,{children:"You will then see the prompt of the Lua command-line interpreter. Type a Lua expression and press Enter, and it will execute immediately and display the result:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'Lua 5.3.6  Copyright (C) 1994-2020 Lua.org, PUC-Rio\n> print("Hello, World!")\nHello, World!\n>\n'})}),"\n",(0,t.jsx)(n.h3,{id:"enhanced-interactive-mode",children:"Enhanced Interactive Mode"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://github.com/giann/croissant",children:(0,t.jsx)(n.code,{children:"croissant"})})," is a variant of the interactive mode, offering additional features such as syntax highlighting and auto-expansion. After activating the environment, the enhanced interactive mode can be started with the following command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:". xxtouch\ncroissant\n"})}),"\n",(0,t.jsx)(n.p,{children:"You will then see the prompt of the Lua command-line interpreter. Type a Lua expression and press Enter, and it will execute immediately and display the result:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'\ud83e\udd50  Croissant 0.0.1 (C) 2019 Benoit Giannangeli\nLua 5.3 Copyright (C) 1994-2018 Lua.org, PUC-Rio\n\u2192 pasteboard\n{  -- table: 0x12bd2d870\n  _VERSION = "3.0.1",\n  read = function: 0x105ea9424,\n  write = function: 0x105ea9558,\n}\n\u2192\n'})}),"\n",(0,t.jsx)(n.h3,{id:"interpreter-mode",children:"Interpreter Mode"}),"\n",(0,t.jsxs)(n.p,{children:["Save the script as a file and upload it to the device at ",(0,t.jsx)(n.code,{children:"/path/to/script.lua"}),", then execute it using the Lua command-line interpreter."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"lua /path/to/script.lua\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsxs)(n.p,{children:["To omit the ",(0,t.jsx)(n.code,{children:"lua"})," command, you can start the script file with ",(0,t.jsx)(n.code,{children:"#!/usr/bin/env lua"})," and change its extension to ",(0,t.jsx)(n.code,{children:".lua"}),"."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"/path/to/script.lua\n"})})]}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsxs)(n.p,{children:["To further omit the path, you can place the script file in the ",(0,t.jsx)(n.code,{children:"/usr/local/bin"})," directory."]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"script.lua\n"})})]}),"\n",(0,t.jsxs)(n.h3,{id:"daemon-mode-daemonlua",children:["Daemon Mode ",(0,t.jsx)(n.code,{children:"daemon.lua"})]}),"\n",(0,t.jsxs)(n.p,{children:["Daemon mode is a lower-level mode compared to ",(0,t.jsx)(n.a,{href:"/docs/appendix/daemon-mode",children:(0,t.jsx)(n.strong,{children:"Daemon Mode"})}),". It is a system-level service launched by ",(0,t.jsx)(n.a,{href:"https://www.launchd.info/",children:(0,t.jsx)(n.code,{children:"launchd"})}),". When the device is in a non-LAN environment but requires centralized control, a daemon can be enabled to actively communicate with external servers."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The daemon can be managed using ",(0,t.jsx)(n.a,{href:"https://support.apple.com/zh-cn/guide/terminal/apdc6c1077b-5d5d-4d35-9c19-60f2397b2369/mac",children:(0,t.jsx)(n.code,{children:"launchctl"})}),"."]}),"\n",(0,t.jsx)(n.li,{children:"The daemon starts automatically with the system and will restart automatically 30 seconds after an unexpected crash."}),"\n",(0,t.jsxs)(n.li,{children:["Developers can further use the ",(0,t.jsx)(n.a,{href:"/docs/appendix/process-scheduling#lock-process-id-file-lockfile",children:(0,t.jsx)(n.code,{children:"lockfile"})})," function to lock a file to ensure its singleton state."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"instructions",children:"Instructions"}),"\n",(0,t.jsxs)(n.p,{children:["You can write a daemon named ",(0,t.jsx)(n.code,{children:"daemon.lua"})," and upload it to ",(0,t.jsx)(n.code,{children:"/usr/local/xxtouch/bin/daemon.lua"}),"."]}),"\n",(0,t.jsx)(n.admonition,{title:"Restriction",type:"caution",children:(0,t.jsx)(n.p,{children:"Daemon mode takes effect after a reboot, soft reboot, or restarting XXTouch\xa0Elite."})}),"\n",(0,t.jsx)(n.h4,{id:"example",children:"Example"}),"\n",(0,t.jsxs)(n.p,{children:["The daemon in this example pushes a text description of the current time into the ",(0,t.jsx)(n.a,{href:"/docs/lua-manual/proc",children:"process queue dictionary"})," ",(0,t.jsx)(n.code,{children:"xxtouch.daemon.test"})," every 3 seconds."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",metastring:'title="daemon.lua" showLineNumbers',children:'if not G_reload then\n  if not lockfile("/tmp/daemon.lua.singleton") then\n    return  -- If the file is already locked by another process, no need to run again\n  end\nelse\n  G_reload = nil\nend\n--\nlocal daemon_file_name = "/var/mobile/Media/1ferver/bin/daemon.lua"\nlocal socket = require("socket")\nlocal lfs = require("lfs")\n--\nfunction file_change_date(file_name)\n  local fattr = lfs.attributes(file_name)\n  if type(fattr) == "table" and fattr.mode == "file" then\n    return fattr.change\n  end\n  return 0\nend\n--\nlocal orig_change = file_change_date(daemon_file_name)\n--\nwhile true do\n  sys.log(string.format("daemon.lua: %d", os.time()))\n  proc_queue_push("xxtouch.daemon.test", string.format("daemon.lua: %d", os.time()))\n  if file_change_date(daemon_file_name) ~= orig_change then\n    break\n  end\n  socket.sleep(3)\nend\n--\nG_reload = true\ndofile(daemon_file_name)\n'})}),"\n",(0,t.jsx)(n.h2,{id:"built-in-command-line-tools",children:"Built-in Command Line Tools"}),"\n",(0,t.jsxs)(n.h3,{id:"record-hid-events-hidrecorder",children:["Record HID Events (",(0,t.jsx)(n.strong,{children:"hidrecorder"}),")"]}),"\n",(0,t.jsx)(n.h4,{id:"instructions-1",children:"Instructions"}),"\n",(0,t.jsxs)(n.p,{children:["Used to dump HID event streams to standard output. See ",(0,t.jsx)(n.a,{href:"/docs/tutorial/record-and-replay",children:"Record and Replay Scripts"})," for details."]}),"\n",(0,t.jsx)(n.h4,{id:"example-1",children:"Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"hidrecorder > /path/to/hid-events.lua\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"install-and-uninstall-apps-installerlua",children:["Install and Uninstall Apps (",(0,t.jsx)(n.strong,{children:"installer.lua"}),")"]}),"\n",(0,t.jsx)(n.h4,{id:"declaration",children:"Declaration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"usage: installer.lua install   [ipa-path]\n       installer.lua uninstall [bundle-id]\n"})}),"\n",(0,t.jsx)(n.h4,{id:"parameters-and-return-values",children:"Parameters and Return Values"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ipa-path"})," Path to the IPA installation package"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"bundle-id"})," Installed ",(0,t.jsx)(n.a,{href:"/docs/lua-manual/app#identifier",children:"App Identifier"})]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"example-2",children:"Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"installer.lua install /path/to/MyApp.ipa   # Install App\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"installer.lua uninstall com.example.MyApp  # Uninstall App\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"start-and-stop-remote-access-remote-accesslua",children:["Start and Stop Remote Access (",(0,t.jsx)(n.strong,{children:"remote-access.lua"}),")"]}),"\n",(0,t.jsx)(n.h4,{id:"declaration-1",children:"Declaration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"remote-access.lua [on|off]\n"})}),"\n",(0,t.jsx)(n.h4,{id:"instructions-2",children:"Instructions"}),"\n",(0,t.jsxs)(n.p,{children:["Equivalent to ",(0,t.jsx)(n.a,{href:"/docs/tutorial/ready-to-develop#enable-remote-access",children:"Enable Remote Access"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"example-3",children:"Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"remote-access.lua on   # Start remote access\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"remote-access.lua off  # Stop remote access\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"remote-lock-and-unlock-remote-locklua",children:["Remote Lock and Unlock (",(0,t.jsx)(n.strong,{children:"remote-lock.lua"}),")"]}),"\n",(0,t.jsx)(n.h4,{id:"declaration-2",children:"Declaration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"usage: remote-lock.lua unlock [password]\n       remote-lock.lua lock\n       remote-lock.lua status\n"})}),"\n",(0,t.jsx)(n.h4,{id:"parameters-and-return-values-1",children:"Parameters and Return Values"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"password"})," Device lock screen password"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"example-4",children:"Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"remote-lock.lua unlock       # Unlock device without password\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"remote-lock.lua unlock 1234  # Unlock device with password\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"remote-lock.lua lock         # Lock device\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"remote-lock.lua status       # Display device lock screen status, returns `true` or `false`\n"})}),"\n",(0,t.jsxs)(n.h3,{id:"uninstall-xxtouchelite-uninstall-xxtouchsh",children:["Uninstall XXTouch\xa0Elite (",(0,t.jsx)(n.strong,{children:"uninstall-xxtouch.sh"}),")"]}),"\n",(0,t.jsx)(n.h4,{id:"example-5",children:"Example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"uninstall-xxtouch.sh\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"danger",children:(0,t.jsxs)(n.p,{children:["This operation is irreversible.\nIt will also remove all ",(0,t.jsx)(n.a,{href:"/docs/appendix/paths-and-permissions",children:"user data"})," related to XXTouch\xa0Elite."]})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>r});var l=a(6540);const t={},i=l.createContext(t);function s(e){const n=l.useContext(i);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),l.createElement(i.Provider,{value:n},e.children)}}}]);