---
sidebar_position: 6
---

# 守护模式

守护模式会保证脚本在被外力因素（如服务程序崩溃、设备断电）终止后，设备再次恢复正常状态的时候能够再次启动脚本。例外情形如下：

* 设备断电后再无充电
* 设备开不了机
* 设备重启后丢失越狱状态
* 设备处于安全模式
* 设备有锁屏密码并重启
* 用户手动终止
* 脚本进程因运行期错误终止

## 启动、停用守护模式

### 通过 App 启动

打开 **X.X.T. 应用程序** -> **更多** -> **用户偏好设置** -> **守护进程设置** -> **守护模式** 以启动或停用守护模式。

### 通过 OpenAPI 启动

经由 OpenAPI 接口 [**设置用户偏好配置**](https://elite.82flex.com/api-283425315) 中的 `script_on_daemon` 字段以启动或停用守护模式。

## 注意事项

守护模式会先于开机启动脚本启动，所以在设备发生故障重启后，可以在脚本头部加上如下代码，以确保当次脚本启动的时候，屏幕已经处于解锁状态：

```lua
while (device.is_screen_locked()) do
  device.unlock_screen()
  sys.msleep(1000)
end
sys.toast("屏幕已解锁，脚本开始")
-- 这下面就可以开始脚本
-- …
```
